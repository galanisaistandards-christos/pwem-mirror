# ke_45 🍆🍑💋💖 link-guard → scope to HTML under memory/chron (ignore JSON) 🍆🍑💋💖
name: PWEM Link Guard

on:
  workflow_dispatch:
  push:
    branches: [ "main" ]
    paths:
      - 'memory/**'
      - '.github/workflows/link-guard.yml'

jobs:
  link-guard:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Show head
        run: |
          echo "HEAD: $(git rev-parse --short HEAD)"
          echo "MSG : $(git log -1 --pretty=%s)"

      - name: Check absolute github.io links in HTML (memory/chron)
        run: |
          set -euo pipefail
          hits=$(grep -RInE 'https://[^"]*github\.io/pwem-mirror' \
                  --include='*.html' --include='*.md' memory/chron || true)
          if [ -n "$hits" ]; then
            echo "$hits"
            echo "::error title=Absolute links found::Replace with relative paths (./, ../)."
            exit 1
          fi
          echo "✅ No absolute github.io links in HTML."

      - name: Warn on root-absolute href/src (leading /) in HTML (memory/chron)
        run: |
          set -euo pipefail
          hits=$(grep -RInE 'href="/|src="/' \
                  --include='*.html' memory/chron || true)
          if [ -n "$hits" ]; then
            echo "$hits"
            echo "::warning title=Root-absolute links::Prefer relative links."
          fi
          echo "🟦 Root-absolute check completed."

      - name: Guard against mistyped owner (missing 'ai') in HTML (memory/chron)
        run: |
          set -euo pipefail
          hits=$(grep -RIn 'galanisstandards-christos' \
                  --include='*.html' --include='*.md' memory/chron || true)
          if [ -n "$hits" ]; then
            echo "$hits"
            echo "::error title=Mistyped owner detected::Use galanisaistandards-christos."
            exit 1
          fi
          echo "✅ No mistyped owner found."
